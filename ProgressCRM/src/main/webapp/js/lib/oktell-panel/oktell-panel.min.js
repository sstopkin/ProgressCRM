/* Oktell-panel.js 0.3.4 http://js.oktell.ru/webpanel */

(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)})(function(t){function e(e){var s,o=e||window.event,r=[].slice.call(arguments,1),l=0,a=0,h=0,u=0,c=0;return e=t.event.fix(o),e.type="oktellPanelMousewheel",o.wheelDelta&&(l=o.wheelDelta),o.detail&&(l=-1*o.detail),o.deltaY&&(h=-1*o.deltaY,l=h),o.deltaX&&(a=o.deltaX,l=-1*a),void 0!==o.wheelDeltaY&&(h=o.wheelDeltaY),void 0!==o.wheelDeltaX&&(a=-1*o.wheelDeltaX),u=Math.abs(l),(!n||n>u)&&(n=u),c=Math.max(Math.abs(h),Math.abs(a)),(!i||i>c)&&(i=c),s=l>0?"floor":"ceil",l=Math[s](l/n),a=Math[s](a/i),h=Math[s](h/i),r.unshift(e,l,a,h),(t.event.dispatch||t.event.handle).apply(this,r)}var n,i,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(t.event.fixHooks)for(var r=s.length;r;)t.event.fixHooks[s[--r]]=t.event.mouseHooks;t.event.special.oktellPanelMousewheel={setup:function(){if(this.addEventListener)for(var t=o.length;t;)this.addEventListener(o[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=o.length;t;)this.removeEventListener(o[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({oktellPanelMousewheel:function(t){return t?this.bind("oktellPanelMousewheel",t):this.trigger("oktellPanelMousewheel")},unOktellPanelMousewheel:function(t){return this.unbind("oktellPanelMousewheel",t)}})}),function(t){function e(){this===s.elem&&(s.pos=[-260,-260],s.elem=!1,o=3)}var n,i,s={pos:[-260,-260]},o=3,r=document,l=r.documentElement,a=r.body;t.event.special.oktellPanelMwheelIntent={setup:function(){var n=t(this).bind("oktellPanelMousewheel",t.event.special.oktellPanelMwheelIntent.handler);return this!==r&&this!==l&&this!==a&&n.bind("mouseleave",e),n=null,!0},teardown:function(){return t(this).unbind("oktellPanelMousewheel",t.event.special.oktellPanelMwheelIntent.handler).unbind("mouseleave",e),!0},handler:function(e){var r=[e.clientX,e.clientY];return this===s.elem||Math.abs(s.pos[0]-r[0])>o||Math.abs(s.pos[1]-r[1])>o?(s.elem=this,s.pos=r,o=250,clearTimeout(i),i=setTimeout(function(){o=10},200),clearTimeout(n),n=setTimeout(function(){o=3},1500),e=t.extend({},e,{type:"oktellPanelMwheelIntent"}),(t.event.dispatch||t.event.handle).apply(this,arguments)):void 0}},t.fn.extend({oktellPanelMwheelIntent:function(t){return t?this.bind("oktellPanelMwheelIntent",t):this.trigger("oktellPanelMwheelIntent")},unOktellPanelMwheelIntent:function(t){return this.unbind("oktellPanelMwheelIntent",t)}}),t(function(){a=r.body,t(r).bind("oktellPanelMwheelIntent.mwheelIntentDefault",t.noop)})}(jQuery),function(t,e,n){t.fn.oktellPanelJScrollPane=function(e){function i(e,i){function s(i){var s,r,u,c,d,p=!1,w=!1;if(k=i,C===n)c=e.scrollTop(),d=e.scrollLeft(),e.css({overflow:"hidden",padding:0}),x=e.innerWidth()+z,E=e.innerHeight(),e.width(x),C=t('<div class="jspPane" />').css("padding",q).append(e.children()),P=t('<div class="jspContainer" />').css({width:x+"px",height:E+"px"}).append(C).appendTo(e);else{if(e.css("width",""),p=k.stickToBottom&&g(),w=k.stickToRight&&isCloseToRight(),u=e.innerWidth()+z!=x||e.outerHeight()!=E,u&&(x=e.innerWidth()+z,E=e.innerHeight(),P.css({width:x+"px",height:E+"px"})),!u&&W==H&&C.outerHeight()==S)return e.width(x),n;W=H,C.css("width",""),e.width(x),P.find(">.jspVerticalBar").remove().end()}C.css("overflow","auto"),H=i.contentWidth?i.contentWidth:C[0].scrollWidth,S=C[0].scrollHeight,C.css("overflow",""),j=H/x,T=S/E,A=T>1,A?(e.addClass("jspScrollable"),s=k.maintainPosition&&D,s&&(r=m()),o(),l(),s&&f(p?S-E:r,!1),b(),y(),k.clickOnTrack&&a()):(e.removeClass("jspScrollable"),C.css({top:0,width:P.width()-z}),v(),h()),c&&e.scrollTop(0)&&f(c,!1),e.trigger("jsp-initialised",[A])}function o(){A&&(P.append(t('<div class="jspVerticalBar" />').append(t('<div class="jspCap jspCapTop" />'),t('<div class="jspTrack" />').append(t('<div class="jspDrag" />').append(t('<div class="jspDragTop" />'),t('<div class="jspDragBottom" />'),t('<div class="jspDragInner" />'))),t('<div class="jspCap jspCapBottom" />'))),U=P.find(">.jspVerticalBar"),B=U.find(">.jspTrack"),L=B.find(">.jspDrag"),I=L.find(">.jspDragInner"),P.unbind("mouseenter.jspInner"),P.unbind("mouseleave.jspInner"),k.dragInnerAnimation&&(P.bind("mouseenter.jspInner",function(){return I.stop(!0,!0),I.fadeIn(100),!0}),P.bind("mouseleave.jspInner",function(){I.stop(!0,!0),I.fadeOut(500)})),k.showArrows&&(V=t('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",getArrowScroll(0,-1)).bind("click.jsp",w),R=t('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",getArrowScroll(0,1)).bind("click.jsp",w),k.arrowScrollOnHover&&(V.bind("mouseover.jsp",getArrowScroll(0,-1,V)),R.bind("mouseover.jsp",getArrowScroll(0,1,R))),appendArrows(B,k.verticalArrowPositions,V,R)),M=E,P.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){M-=t(this).outerHeight()}),L.hover(function(){L.addClass("jspHover")},function(){L.removeClass("jspHover")}).bind("mousedown.jsp",function(e){t("html").bind("dragstart.jsp selectstart.jsp",w),L.addClass("jspActive");var n=e.pageY-L.position().top;return t("html").bind("mousemove.jsp",function(t){c(t.pageY-n,!1)}).bind("mouseup.jsp mouseleave.jsp",u),!1}),r())}function r(){B.height(M+"px"),D=0,N=k.verticalGutter+B.outerWidth(),C.width(x-N-z);try{0===U.position().left&&C.css("margin-left",N+"px")}catch(t){}}function l(){S=C.outerHeight(),T=S/E,A&&(F=Math.ceil(1/T*M),F>k.verticalDragMaxHeight?F=k.verticalDragMaxHeight:k.verticalDragMinHeight>F&&(F=k.verticalDragMinHeight),L.height(F+"px"),O=M-F,d(D))}function a(){h(),A&&B.bind("mousedown.jsp",function(e){if(e.originalTarget===n||e.originalTarget==e.currentTarget){var i,s=t(this),o=s.offset(),r=e.pageY-o.top-D,l=!0,a=function(){var t=s.offset(),o=e.pageY-t.top-F/2,u=E*k.scrollPagePercent,d=O*u/(S-E);if(0>r)D-d>o?Y.scrollByY(-u):c(o);else{if(!(r>0))return h(),n;o>D+d?Y.scrollByY(u):c(o)}i=setTimeout(a,l?k.initialDelay:k.trackClickRepeatFreq),l=!1},h=function(){i&&clearTimeout(i),i=null,t(document).unbind("mouseup.jsp",h)};return a(),t(document).bind("mouseup.jsp",h),!1}})}function h(){B&&B.unbind("mousedown.jsp")}function u(){t("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),L&&L.removeClass("jspActive")}function c(t,e){A&&(0>t?t=0:t>O&&(t=O),e===n&&(e=k.animateScroll),e?Y.animate(L,"top",t,d):(L.css("top",t),d(t)))}function d(t){t===n&&(t=L.position().top),P.scrollTop(0),D=t;var i=0===D,s=D==O,o=t/O,r=-o*(S-E);(J!=i||Q!=s)&&(J=i,Q=s,e.trigger("jsp-arrow-change",[J,Q,G,$])),p(i,s),C.css("top",r),e.trigger("jsp-scroll-y",[-r,i,s]).trigger("scroll")}function p(t,e){k.showArrows&&(V[t?"addClass":"removeClass"]("jspDisabled"),R[e?"addClass":"removeClass"]("jspDisabled"))}function f(t,e){var n=t/(S-E);c(n*O,e)}function m(){return-C.position().top}function g(){var t=S-E;return t>20&&10>t-m()}function b(){P.unbind(K).bind(K,function(t,e,n,i){return Y.scrollByY(-i*k.mouseWheelSpeed,!1),k.onScroll&&k.onScroll(),!1})}function v(){P.unbind(K)}function w(){return!1}function y(){var t,e,i,s=!1;P.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(n){var o=n.originalEvent.touches[0];t=m(),e=o.pageY,i=!1,s=!0}).bind("touchmove.jsp",function(n){if(s){var o=n.originalEvent.touches[0];return Y.scrollToY(t+e-o.pageY),i=i||Math.abs(e-o.pageY)>5,k.onScroll&&k.onScroll(),!1}}).bind("touchend.jsp",function(){s=!1}).bind("click.jsp-touchclick",function(){return i?(i=!1,!1):n})}function _(){var t=m();e.removeClass("jspScrollable").unbind(".jsp"),e.replaceWith(X.append(C.children())),X.scrollTop(t)}var k,C,x,E,P,H,S,j,T,A,L,I,O,D,U,B,N,M,F,V,R,q,z,W,Y=this,J=!0,G=!0,Q=!1,$=!1,X=e.clone(!1,!1).empty(),K=t.fn.oktellPanelMwheelIntent?"oktellPanelMwheelIntent.jsp":"oktellPanelMousewheel.jsp";q=e.css("paddingTop")+" "+e.css("paddingRight")+" "+e.css("paddingBottom")+" "+e.css("paddingLeft"),z=(parseInt(e.css("paddingLeft"),10)||0)+(parseInt(e.css("paddingRight"),10)||0),t.extend(Y,{reinitialise:function(e){e=t.extend({},k,e),s(e)},scrollToY:function(t,e){f(t,e)},scrollToPercentY:function(t,e){f(t*(S-E),e)},scrollByY:function(t,e){var n=m()+Math[0>t?"floor":"ceil"](t),i=n/(S-E);c(i*O,e)},positionDragY:function(t,e){c(t,e)},animate:function(t,e,n,i){var s={};s[e]=n,t.animate(s,{duration:k.animateDuration,easing:k.animateEase,queue:!1,step:i})},getContentPositionY:function(){return m()},getContentWidth:function(){return H},getContentHeight:function(){return S},getPercentScrolledY:function(){return m()/(S-E)},getIsScrollableV:function(){return A},getContentPane:function(){return C},scrollToBottom:function(t){c(O,t)},destroy:function(){_()}}),s(i)}return e=t.extend({},t.fn.oktellPanelJScrollPane.defaults,e),t.each(["arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){e[this]=e[this]||e.speed}),this.each(function(){var n=t(this),s=n.data("jsp");s?s.reinitialise(e):(t("script",n).filter('[type="text/javascript"],:not([type])').remove(),s=new i(n,e),n.data("jsp",s))})},t.fn.oktellPanelJScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,contentWidth:n,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,mouseWheelSpeed:3,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8,dragInnerAnimation:!0,onScroll:null}}(jQuery,this);var __slice=[].slice,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__hasProp={}.hasOwnProperty;(function(t){var e,n,i,s,o,r,l,a,h,u,c,d,p,f,m,g,b,v,w,y,_,k,C,x,E,P,H,S,j,T,A,L,I,O,D,U,B,N,M,F,V,R,q,z,W,Y,J,G;if(!t)throw new i("Error init oktell panel, jQuery ( $ ) is not defined");return b=function(t,e,n){var i;return i="",function(){var s,o,r,l,a;return r=this,s=arguments,l=function(){var e;return i=null,n?void 0:e=t.apply(r,s)},o=n&&!i,clearTimeout(i),i=setTimeout(l,e),o&&(a=t.apply(r,s)),a}},k=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},A=function(){var t;try{return console.log.apply(console,arguments)}catch(e){t=e}},g=function(e,n,i){var s,o,r,l;return arguments.length>1&&"[object Object]"!=n+""?(i=t.extend({},i),null==n&&(i.expires=-1),"number"==typeof i.expires&&(r=i.expires,l=i.expires=new Date,l.setSeconds(l.getSeconds()+r)),n+="",document.cookie=[encodeURIComponent(e),"=",i.raw?n:encodeURIComponent(n),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")):(i=n||{},o="",s=i.raw?function(t){return t}:decodeURIComponent,(o=RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?s(o[1]):null)},I=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e,n;return e=0|16*Math.random(),n="x"===t?e:8|3&e,n.toString(16)})},o=function(){function t(t,e,n,i,s){var o;null==e&&(e=0),"string"==typeof t&&t&&0===window.webkitNotifications.checkPermission()&&("function"==typeof n?(s=n,n="",i=null):"function"==typeof i&&(s=i,i=null),o=window.webkitNotifications.createNotification("favicon.ico",t,n||""),i&&(o.tag=i),o.show(),e=parseInt(e),e&&setTimeout(function(){return o.close()},1e3*e),o.onclick=function(){var t,e;return e=arguments[0],t=arguments.length>=2?__slice.call(arguments,1):[],"function"==typeof window.focus&&window.focus(),o.close(),"function"==typeof s?s.apply(window,[]):void 0},this.close=function(){return null!=o?"function"==typeof o.close?o.close():void 0:void 0})}return t}(),n=function(){function e(t,e){this.usersVisibilityCss="invisibleDep",this.lastFilteredUsers=[],this.isSorted=!1,this.visible=!0,this.users=[],this.id=t&&"00000000-0000-0000-0000-000000000000"!==t?t:this.withoutDepName,this.name=this.id!==this.withoutDepName&&e?e:this.langs.panel.withoutDepartment,this.isOpen=null!=this.config().departmentVisibility[this.id]?this.config().departmentVisibility[this.id]:!0}return e.prototype.logGroup="Department",e.prototype.getEl=function(e){return this.el||(this.el=t(this.template.replace(/\{\{department}\}/g,k(this.name)))),e?(this._oldIsOpen=this.isOpen,this.showUsers(!0,!0)):this.showUsers(null!=this._oldIsOpen?this._oldIsOpen:this.isOpen),this.el.data("department",this),this.el},e.prototype.getContainer=function(){return this.el.find("tbody")},e.prototype.showUsers=function(t,e){var n;return t===void 0&&(t=!this.isOpen),this.hideEl||(this.hideEl=this.el.find("table")),this.hideEl.stop(!0,!0),e||(this.isOpen=t,n=this.config(),n.departmentVisibility[this.id]=this.isOpen,this.config(n)),t?(this.el.toggleClass(this.usersVisibilityCss,!1),this.hideEl.show()):(this.el.toggleClass(this.usersVisibilityCss,!0),this.hideEl.hide())},e.prototype.getInfo=function(){return this.name+" "+this.id},e.prototype.clearUsers=function(){return this.users=[]},e.prototype.show=function(t){return this.el&&!this.visible?(t?this.el.slideDown(200):this.el.show(),this.visible=!0):void 0},e.prototype.hide=function(t){return this.el&&this.visible?(t?this.el.slideUp(200):this.el.hide(),this.visible=!1):void 0},e.prototype.getUsers=function(t,e,n){var i,s,o,r,l,a,h,u,c,d,p,f;if(this.isSorted||this.sortUsers(),o=[],i=!1,""===t)if(e)for(d=this.users,r=0,h=d.length;h>r;r++)s=d[r],s.setSelection(),o.push(s);else for(p=this.users,l=0,u=p.length;u>l;l++)s=p[l],0!==s.state&&(s.setSelection(),o.push(s));else for(f=this.users,a=0,c=f.length;c>a;a++)s=f[a],s.isFiltered(t,e,n)&&(o.push(s),s.number!==t||i||(i=s));return this.lastFilteredUsers=o,[o,i]},e.prototype.sortUsers=function(){return this.users.sort(this.sortFn)},e.prototype.sortFn=function(t,e){return t.nameLower>e.nameLower?1:t.nameLower<e.nameLower?-1:t.number>e.number?1:t.number<e.number?-1:0},e.prototype.addUser=function(t){return t.number?this.users.push(t):void 0},e}(),e=function(){function e(e){this.doAction=__bind(this.doAction,this),this.state=!1,this.additionalActions={},this.hasHover=!1,this.buttonLastAction="",this.firstLiCssPrefix="m_button_action_",this.noneActionCss="",this.els=t(),this.buttonEls=t(),this.init(e)}return e.prototype.logGroup="User",e.prototype.init=function(t){var e,n,i,s,o,r,l,a,h,u,c,d;return this.id=null!=(i=t.id)?(""+i).toLowerCase():void 0,this.isFantom=t.isFantom||!1,this.number=(null!=(s=t.number)?""+s:void 0)||"",this.number||(this.invisible=!0),this.numberFormatted=(null!=(o=t.numberFormatted)?""+o:void 0)||this.number,this.numberHtml=k(this.numberFormatted),this.name=(null!=(r=t.name)?""+r:void 0)||"",this.nameLower=this.name.toLowerCase(),this.letter=(null!=(l=this.name[0])?l.toUpperCase():void 0)||(null!=(a=this.number)?(""+a[0]).toLowerCase():void 0),this.nameHtml=t.name&&""+t.name!==this.number?k(t.name):this.numberHtml,this.numberHtml===this.nameHtml&&(this.numberHtml=""),this.isIvr=t.isIvr,this.ivrName=t.ivrName,n=this.nameHtml.split(/\s+/),n.length>1&&""+t.name!==this.number?(this.nameHtml1=n[0],this.nameHtml2=" "+n.splice(1).join(" ")):(this.nameHtml1=this.nameHtml,this.nameHtml2=""),e=this.elNumberHtml,this.elNumberHtml=this.numberHtml!==this.nameHtml?this.numberHtml:"",this.elNumberHtml!==e&&null!=this.el&&this.el.find(".o_number").text(this.elNumberHtml),null!=(h=this.el)&&h.find(".b_contact_title wrapword a").text(this.nameHtml),this.avatarLink32x32=t.avatarLink32x32||this.defaultAvatar32||"",this.defaultAvatarCss=this.avatarLink32x32?"":"m_default",this.departmentId=(null!=t?null!=(u=t.numberObj)?u.departmentid:void 0:void 0)&&"00000000-0000-0000-0000-000000000000"!==(null!=t?t.numberObj.departmentid:void 0)?null!=t?t.numberObj.departmentid:void 0:this.withoutDepName,this.department="www_without"===this.departmentId?this.langs.panel.withoutDepartment:null!=t?null!=(c=t.numberObj)?c.department:void 0:void 0,null!=(null!=(d=t.numberObj)?d.state:void 0)?this.setState(t.numberObj.state):null!=t.state?this.setState(t.state):this.setState(1),this.loadActions()},e.prototype.regexps={name1:/\{\{name1\}\}/,name2:/\{\{name2\}\}/,number:/\{\{number\}\}/,dtmf:/\{\{dtmf\}\}/,avatarLink32x32:/\{\{avatarLink32x32\}\}/,css:/\{\{css\}\}/,letter:/\{\{letter\}\}/},e.prototype.setState=function(t){var e=this;return t=parseInt(t),t!==this.state?(this.state=t,this.setStateCss(),this.buttonEls.length?(this.loadActions(),setTimeout(function(){return e.loadActions()},100)):void 0):void 0},e.prototype.setStateCss=function(){return this.els.length?0===this.state?this.els.removeClass("m_busy").addClass("m_offline"):5===this.state?this.els.removeClass("m_offline").addClass("m_busy"):this.els.removeClass("m_offline").removeClass("m_busy"):void 0},e.prototype.getInfo=function(){return'"'+this.number+'" '+this.state+" "+this.name},e.prototype.isFiltered=function(t,e,n){var i;return t&&"string"==typeof t||!e&&(e||0===this.state)?e||!e&&0!==this.state?this.number&&-1!==this.number.indexOf(t)||-1!==(" "+this.name).toLowerCase().indexOf(t)?(this.setSelection(t),!0):"en"===n&&(i=this.toRu(t))&&-1!==(" "+this.name).toLowerCase().indexOf(i)?(this.setSelection(i),!0):"ru"===n&&(i=this.toEn(t))&&-1!==(" "+this.name).toLowerCase().indexOf(i)?(this.setSelection(i),!0):!1:!1:(this.setSelection(),!0)},e.prototype.showLetter=function(t){var e;return null!=(e=this.el)?e.find(".b_capital_letter span").text(t?this.letter:""):void 0},e.prototype.getEl=function(e){var n,i;return(!this.el||e)&&(i=this.template.replace(this.regexps.name1,this.nameHtml1).replace(this.regexps.name2,this.nameHtml2).replace(this.regexps.number,this.numberHtml).replace(this.regexps.dtmf,this.langs.panel.dtmf).replace(this.regexps.avatarLink32x32,this.avatarLink32x32).replace(this.regexps.css,this.defaultAvatarCss),n=t(i),n.data("user",this),this.initButtonEl(n.find(".oktell_button_action")),this.els=this.els.add(n),this.setStateCss(),this.el||(this.el=n,this.elName=this.el.find(".b_contact_name b"),this.elName2=this.el.find(".b_contact_name span"),this.elNumber=this.el.find(".o_number"),this.elDtmf=this.el.find(".o_dtmf"))),n=n||this.el},e.prototype.setSelection=function(t){var e;if(null!=this.el){if(t)return e=RegExp("("+t+")","gi"),this.elName.html(this.nameHtml1.replace(e,'<span class="selected_text">$1</span>')),this.elName2.html(this.nameHtml2.replace(e,'<span class="selected_text">$1</span>')),this.elNumber.html(this.numberHtml.replace(e,'<span class="selected_text">$1</span>')),this.elHasSelection=!0;if(this.elHasSelection)return this.elName.text(this.nameHtml1),this.elName2.text(this.nameHtml2),this.elNumber.text(this.numberHtml),this.elHasSelection=!1}},e.prototype.initButtonEl=function(t){var e=this;return this.buttonEls=this.buttonEls.add(t),t.data("user",this),t.children(":first").bind("click",function(){return e.doAction(e.buttonLastAction)}),this.buttonLastAction?t.removeClass(this.noneActionCss).addClass(this.firstLiCssPrefix+this.buttonLastAction.toLowerCase()):t.addClass(this.noneActionCss)},e.prototype.getButtonEl=function(){var e;return e=t(this.buttonTemplate),this.initButtonEl(e),e},e.prototype.isHovered=function(t){return this.hasHover!==t?(this.hasHover=t,this.hasHover?this.loadActions(!0):void 0):void 0},e.prototype.loadOktellActions=function(){var t,e,n;e=this.isIvr?["endCall"]:this.oktell.getPhoneActions(this.number||this.id),n=this.additionalActions;for(t in n)__hasProp.call(n,t)&&e.push(t);return e},e.prototype.addAction=function(t,e){return t&&"string"==typeof t&&"function"==typeof e?this.additionalActions[t]=e:void 0},e.prototype.removeAction=function(t){return t&&delete this.additionalActions[t]},e.prototype.loadActions=function(){var t,e,n;e=this.loadOktellActions(),n=this.additionalActions;for(t in n)__hasProp.call(n,t)&&e.push(t);return t=(null!=e?e[0]:void 0)||"",this.buttonLastAction===t?e:(this.buttonLastAction&&this.buttonEls.removeClass(this.firstLiCssPrefix+this.buttonLastAction.toLowerCase()),t?(this.buttonLastAction=t,this.buttonEls.removeClass(this.noneActionCss).addClass(this.firstLiCssPrefix+this.buttonLastAction.toLowerCase())):(this.buttonLastAction="",this.buttonEls.addClass(this.noneActionCss)),e)},e.prototype.doAction=function(t){var e,n,i,s,o;if(t)switch(e=this.number,"function"==typeof this.beforeAction&&this.beforeAction(t),t){case"call":return this.oktell.call(e);case"conference":return this.oktell.conference(e);case"intercom":return this.oktell.intercom(e);case"transfer":return this.oktell.transfer(e);case"toggle":return this.oktell.toggle();case"ghostListen":return this.oktell.ghostListen(e);case"ghostHelp":return this.oktell.ghostHelp(e);case"ghostConference":return this.oktell.ghostConference(e);case"endCall":return this.oktell.endCall(e);case"hold":return"function"==typeof(n=this.oktell).hold?n.hold():void 0;case"resume":return"function"==typeof(i=this.oktell).resume?i.resume():void 0;case"answer":return"function"==typeof(s=this.oktell).answer?s.answer():void 0;default:return"function"==typeof(o=this.additionalActions)[t]?o[t]():void 0}},e.prototype.doLastFirstAction=function(){return this.buttonLastAction?(this.doAction(this.buttonLastAction),!0):!1},e.prototype.letterVisibility=function(t){return this.el&&this.el.length?t?this.el.find(".b_capital_letter span").text(this.letter):this.el.find(".b_capital_letter span").text(""):void 0},e.prototype.replacerToRu={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."},e.prototype.replacerToEn={"й":"q","ц":"w","у":"e","к":"r","е":"t","н":"y","г":"u","ш":"i","щ":"o","з":"p","х":"[","ъ":"]","ф":"a","ы":"s","в":"d","а":"f","п":"g","р":"h","о":"j","л":"k","д":"l","ж":";","э":"'","я":"z","ч":"x","с":"c","м":"v","и":"b","т":"n","ь":"m","б":",","ю":".",".":"/"},e.prototype.toRu=function(t){var e=this;return t.replace(/[A-z\/,.;\'\]\[]/g,function(t){return t===t.toLowerCase()?e.replacerToRu[t]:e.replacerToRu[t.toLowerCase()].toUpperCase()})},e.prototype.toEn=function(t){var e=this;return t.replace(/[А-яёЁ]/g,function(t){return t===t.toLowerCase()?e.replacerToEn[t]:e.replacerToEn[t.toLowerCase()].toUpperCase()})},e}(),s=function(){function i(i,s,r,l,a,h,u,c,d){this.onPbxNumberStateChange=__bind(this.onPbxNumberStateChange,this);var p,f,m,g,v,w,y=this;this.defaultConfig={departmentVisibility:{},showDeps:!0,showOffline:!1},this.useNativeScroll=c,this.stickyHeaders=u,this.jScrollPaneParams={mouseWheelSpeed:50,hideFocus:!0,verticalGutter:-13},this.allActions={answer:{icon:"/img/icons/action/call.png",iconWhite:"/img/icons/action/white/call.png",text:this.langs.actions.answer},call:{icon:"/img/icons/action/call.png",iconWhite:"/img/icons/action/white/call.png",text:this.langs.actions.call},conference:{icon:"/img/icons/action/confinvite.png",iconWhite:"/img/icons/action/white/confinvite.png",text:this.langs.actions.conference},transfer:{icon:"/img/icons/action/transfer.png",text:this.langs.actions.transfer},toggle:{icon:"/img/icons/action/toggle.png",text:this.langs.actions.toggle},intercom:{icon:"/img/icons/action/intercom.png",text:this.langs.actions.intercom},endCall:{icon:"/img/icons/action/endcall.png",iconWhite:"/img/icons/action/white/endcall.png",text:this.langs.actions.endCall},ghostListen:{icon:"/img/icons/action/ghost_monitor.png",text:this.langs.actions.ghostListen},ghostHelp:{icon:"/img/icons/action/ghost_help.png",text:this.langs.actions.ghostHelp},hold:{icon:"/img/icons/action/ghost_help.png",text:this.langs.actions.hold},resume:{icon:"/img/icons/action/ghost_help.png",text:this.langs.actions.resume},dtmf:{icon:"",text:this.langs.actions.dtmf}},this.actionCssPrefix="i_",this.lastDropdownUser=!1,w=this,e.prototype.beforeAction=function(t){return w.beforeUserAction(this,t)},this.departments=[],this.departmentsById={},this.simpleListEl=t(this.usersTableTemplate),this.filterFantomUserNumber=!1,this.userWithGeneratedButtons={},this.debugMode=d,this.dropdownPaddingBottomLeft=3,this.dropdownOpenedOnPanel=!1,this.regexps={actionText:/\{\{actionText\}\}/,action:/\{\{action\}\}/,css:/\{\{css\}\}/,dep:/\{\{department}\}/g},g=!1,this.options=a,this.contained=h,this.usersByNumber={},this.me=!1,this.oktell=i,this.panelUsers=[],this.panelUsersFiltered=[],this.abonents={},this.hold={},this.queue={},this.oktell=i,e.prototype.oktell=i,this.filter=!1,this.panelEl=s,this.dtmfEl=this.panelEl.find(".i_extension"),this.dropdownEl=r,this.dropdownElLiTemplate=this.dropdownEl.html(),this.dropdownEl.empty(),this.keypadEl=this.panelEl.find(".j_phone_keypad"),this.keypadIsVisible=!1,this.usersListBlockEl=this.panelEl.find(".j_main_list"),this.scrollContainer="",this.scrollContent="",this.usersListEl=this.simpleListEl.find("tbody"),this.abonentsListBlock=this.panelEl.find(".j_abonents"),this.abonentsListEl=this.abonentsListBlock.find("tbody"),this.abonentsHeaderTextEl=this.abonentsListBlock.find("b_marks_label"),this.talkTimeEl=this.abonentsListBlock.find(".b_marks_time"),this.holdBlockEl=this.panelEl.find(".j_hold"),this.holdListEl=this.holdBlockEl.find("tbody"),this.queueBlockEl=this.panelEl.find(".j_queue"),this.queueListEl=this.queueBlockEl.find("tbody"),this.filterInput=this.panelEl.find("input"),this.filterClearCross=this.panelEl.find(".jInputClear_close"),p=!1,this.buttonShowOffline=this.panelEl.find(".b_list_filter .i_online"),this.buttonShowDeps=this.panelEl.find(".b_list_filter .i_group"),this.buttonShowOffline.bind("click",function(){return y.config({showOffline:!y.showOffline}),y.setFilter(y.filter,!0)}),this.buttonShowDeps.bind("click",function(){return y.config({showDeps:!y.showDeps}),y.setFilter(y.filter,!0)}),this.dtmfEl.find(".o_close").bind("click",function(){return y.hideDtmf()}),this.dtmfEl.find(".btn-small").bind("click",function(e){return y.sendDtmf(t(e.target).text())}),this.usersWithBeforeConnectButtons=[],this.config(),n.prototype.config=function(){var t;return t=arguments.length>=1?__slice.call(arguments,0):[],y.config.apply(y,t)},this.allUserDep=new n("all_user_dep","allUsers"),this.allUserDep.template=this.usersTableTemplate,this.exactMatchUserDep=new n("exact_match_user_dep","exactUser"),this.exactMatchUserDep.template=this.usersTableTemplate,this.initJScrollPane=function(){return y.useNativeScroll?(y.scrollContainer=y.usersListBlockEl,y.scrollContent=y.usersListBlockEl,y.usersListBlockEl.css("overflow-y","auto")):(y.usersListBlockEl.oktellPanelJScrollPane(y.jScrollPaneParams),y.jScrollPaneAPI=y.usersListBlockEl.data("jsp"),y.scrollContainer=y.usersListBlockEl.find(".jspContainer"),y.scrollContent=y.usersListBlockEl.find(".jspPane")),y.stickyHeaders?y.usersListBlockEl.bind("scroll",function(){return y.processStickyHeaders()}):void 0},this.initJScrollPane(),this.reinitScroll=function(){var t;return y.useNativeScroll?void 0:null!=(t=y.jScrollPaneAPI)?t.reinitialise():void 0},this.resetDepsWidth=function(){var t,e;return y.useNativeScroll||y.contained||!y.scrollContent?void 0:(t=parseInt(y.scrollContent.css("width")),y.scrollContent.find(".b_department").css("width",t+"px"),null!=(e=y.currentTopHeaderClone)?e.css({width:t+"px"}):void 0)},this.userScrollerToTop=function(){return y.useNativeScroll?y.usersListBlockEl.scrollTop(0):y.jScrollPaneAPI.scrollToY(0)},this.filterClearCross.bind("click",function(){return y.clearFilter()}),this.filterInput.bind("keyup",function(t){return y.oktellConnected?(p||(p=b(function(){return y.setFilter((""+y.filterInput.val()).toLowerCase())},100)),y.filterInput.val()?y.filterClearCross.show():y.filterClearCross.hide(),13===t.keyCode?(y.filterInput.blur(),setTimeout(function(){var t;return null!=(t=y.scrollContent.find("tr:first").data("user"))&&t.doLastFirstAction(),y.clearFilter()},50)):p(),!0):!0}),this.panelEl.bind("click",function(e){var n,i,s,o,r;return o=t(e.target),o.is(".b_department_header")||o.parents(".b_department_header").size()>0?(s=o.parents(".b_department").data("department"),null!=(null!=s?s.showUsers:void 0)&&(s.showUsers(),y.clearSelection(),y.reinitScroll()),y.setUserListHeight(),!1):o.is(".o_dtmf")?(y.showDtmf(),!1):(o.is(".oktell_button_action .g_first")?n=o.parent():o.is(".oktell_button_action .g_first i")?n=o.parent().parent():o.is(".b_contact .drop_down")?i=o.parent():o.is(".b_contact .drop_down i")&&(i=o.parent().parent()),null==n&&null==i||n&&0===n.size()||i&&0===i.size()?!0:null!=n&&n.size()?!0:null!=i&&i.size()?(r=i.data("user"),r&&y.showDropdown(r,i,r.loadOktellActions(),!0),!0):void 0)}),this.dropdownEl.bind("click",function(e){var n,i,s,o;if(s=t(e.target),s.is("[data-action]"))i=s;else{if(0===s.closest("[data-action]").size())return!0;i=s.closest("[data-action]")}return(n=i.data("action"))?(o=y.dropdownEl.data("user"),n&&o&&o.doAction(n),y.dropdownEl.hide()):void 0}),m="",this.dropdownEl.hover(function(){return clearTimeout(m)},function(){return m=setTimeout(function(){return y.hideActionListDropdown()},500)}),this.panelEl.find(".j_keypad_expand").bind("click",function(){return y.toggleKeypadVisibility(),y.filterInput.focus()}),this.keypadEl.find("li").bind("click",function(e){return y.filterInput.focus(),y.filterInput.val(y.filterInput.val()+t(e.currentTarget).find("button").data("num")),y.filterInput.keyup()}),this.setUserListHeight=function(){var e;return e=t(window).height()-y.usersListBlockEl[0].offsetTop+"px",y.usersListBlockEl.css({height:e}),y.reinitScroll(),y.resetDepsWidth()},this.setUserListHeight(),f=b(function(){return y.userScrollerToTop(),y.setUserListHeight()},150),t(window).bind("resize",function(){return f()}),this.options.hideOnDisconnect&&this.hidePanel(!0),i.on("webphoneConnect",function(){return y.panelEl.addClass("webphone")}),i.on("webphoneDisconnect",function(){return y.panelEl.removeClass("webphone")}),i.on("disconnect",function(){var t,e,n,i;y.options.hideOnDisconnect&&y.hidePanel(),y.resetStickyHeaders(),y.oktellConnected=!1,y.usersByNumber={},y.panelUsers=[],y.setPanelUsersHtml([]),y.setAbonents([]),y.setHold({hasHold:!1}),y.filterInput.val(""),y.setFilter("",!0),y.setQueue([]),n=y.userWithGeneratedButtons,i=[];for(t in n)e=n[t],i.push(e.loadActions());return i}),i.on("connect",function(){var t,s,o,r,a,h,u,c,d,p,f,m,g,b,v,w,_,k;y.oktellConnected=!0,u=i.getMyInfo(),u.userid=(""+u.userid).toLowerCase(),y.myNumber=null!=(w=u.number)?""+w:void 0,e.prototype.defaultAvatar=u.defaultAvatar,e.prototype.defaultAvatar32=u.defaultAvatar32x32,e.prototype.defaultAvatar64=u.defaultAvatar64x64,y.departments=[],y.departmentsById={},t={},f=new n,p=i.getUsers(),c=i.getNumbers();for(o in p)__hasProp.call(p,o)&&(g=p[o],delete c[g.number]);for(a in c)__hasProp.call(c,a)&&(r=c[a],o=I(),p[o]={id:o,number:a,name:r.caption,numberObj:r});for(h in p)__hasProp.call(p,h)&&(d=p[h],m=(null!=(_=d.number)?""+_:void 0)||"",m&&(y.usersByNumber[m]?(g=y.usersByNumber[m],d.isFantom=!1,g.init(d)):(g=new e(d),g.number&&(y.usersByNumber[g.number]=g)),g.id!==u.userid?(y.panelUsers.push(g),g.departmentId&&"00000000-0000-0000-0000-000000000000"!==g.departmentId&&g.departmentId!==y.withoutDepName?(t[g.departmentId]?s=t[g.departmentId]:(s=t[g.departmentId]=new n(g.departmentId,g.department),y.departments.push(s),y.departmentsById[g.departmentId]=s),s.addUser(g)):f.addUser(g),y.allUserDep.addUser(g)):y.me=g));for(y.departments.sort(function(t,e){return t.name>e.name?1:e.name>t.name?-1:0}),y.departments.push(f),y.departmentsById[f.id]=f,i.offNativeEvent("pbxnumberstatechanged",y.onPbxNumberStateChange),i.onNativeEvent("pbxnumberstatechanged",y.onPbxNumberStateChange),setTimeout(function(){return y.setAbonents(i.getAbonents()),y.setHold(i.getHoldInfo())},1e3),y.setFilter("",!0),setTimeout(function(){return y.setUserListHeight()},500),i.getQueue(function(t){return t.result?y.setQueue(t.queue):void 0}),k=y.usersWithBeforeConnectButtons,b=0,v=k.length;v>b;b++)g=k[b],g.loadActions();
return y.contained||y.options.hideOnDisconnect?y.showPanel():y.panelEl.show(),y.setTalking("talk"===i.getState()),"function"==typeof l?l():void 0}),i.on("abonentsChange",function(t){return y.oktellConnected?(i.conferenceId()?(y.panelEl.addClass("conference"),y.hideDtmf()):y.panelEl.removeClass("conference"),y.setAbonents(t),y.reloadActions()):void 0}),i.on("holdStateChange",function(t){return y.oktellConnected?(y.setHold(t),y.reloadActions()):void 0}),i.on("talkTimer",function(t,e){return y.oktellConnected?t===!1?y.talkTimeEl.text(""):y.talkTimeEl.text(e):void 0}),i.on("stateChange",function(t){return y.oktellConnected?(y.reloadActions(),y.setTalking("talk"===t)):void 0}),i.on("queueChange",function(t){return y.oktellConnected?y.setQueue(t):void 0}),i.on("connectError",function(){return y.options.hideOnDisconnect?void 0:y.showPanel()}),v=null,i.on("ringStart",function(){return y.options.useNotifies?v=new o(y.langs.callPopup.title):void 0}),i.on("ringStop",function(){return null!=v&&"function"==typeof v.close&&v.close(),v=null})}return i.prototype.logGroup="List",i.prototype.clearSelection=function(){var t;return document.selection&&document.selection.empty?document.selection.empty():window.getSelection?(t=window.getSelection(),t.removeAllRanges()):void 0},i.prototype.initStickyHeaders=function(){var e,n,i,s,o,r,l,a,h,u=this;if(this.stickyHeaders&&(this.resetStickyHeaders(),this.oktellConnected&&(this.headerEls=this.usersListBlockEl.find(".b_department_header").toArray(),0!==this.headerEls.length))){if(0===t(this.headerEls[0]).width())return setTimeout(function(){return u.initStickyHeaders()},500),void 0;for(this.headerFisrt=this.headerEls[0],this.headerLast=this.headerEls.length?this.headerEls[this.headerEls.length-1]:null,a=this.headerEls,i=s=0,r=a.length;r>s;i=++s)n=a[i],this.headerEls[i]=t(n);for(e=this.scrollContainer.offset().top,h=this.headerEls,i=o=0,l=h.length;l>o;i=++o)if(n=h[i],n.offset().top>e||i===this.headerEls.length-1){this.processStickyHeaders(i-1);break}return this.processStickyHeaders()}},i.prototype.headerHeight=24,i.prototype.cloneHeaderHeight=null,i.prototype.processStickyHeaders=function(e){var n,i,s,o,r,l=this;if((null!=(o=this.headerEls)?o.length:void 0)>0){if(null!=e)return 0>e&&(e=0),this.currentTopIndex=e,null!=(r=this.currentTopHeaderClone)&&r.remove(),this.currentTopHeaderClone=this.headerEls[this.currentTopIndex].clone(),this.cloneHeaderHeight=this.headerEls[this.currentTopIndex].height(),this.currentTopHeaderClone.addClass("b_sticky_header"),this.currentTopHeaderClone.bind("click",function(){return l.headerEls[l.currentTopIndex].click(),l.initStickyHeaders(),l.reinitScroll()}),t(".b_sticky_header_container").empty().append(this.currentTopHeaderClone),this.currentTopHeaderClone.offset({top:this.scrollContainer.offset().top}),this.processStickyHeaders();if(null!=this.currentTopIndex)if(n=this.scrollContainer.offset().top,i=this.headerEls[this.currentTopIndex].offset().top,i>n){if(0!==this.currentTopIndex)return this.processStickyHeaders(this.currentTopIndex-1);if(!this.currentTopHeaderClone.data("hidden"))return this.currentTopHeaderClone.data("hidden",!0),this.currentTopHeaderClone.hide()}else if(this.currentTopHeaderClone.data("hidden")&&(this.currentTopHeaderClone.data("hidden",!1),this.currentTopHeaderClone.show()),this.headerEls[this.currentTopIndex+1]){if(s=this.headerEls[this.currentTopIndex+1].offset().top,s>n+(this.cloneHeaderHeight||this.headerHeight))return this.currentTopHeaderClone.offset({top:n});if(s>n)return this.currentTopHeaderClone.offset({top:s-(this.cloneHeaderHeight||this.headerHeight)});if(n>s)return this.processStickyHeaders(this.currentTopIndex+1)}}},i.prototype.resetStickyHeaders=function(){var t;return null!=(t=this.currentTopHeaderClone)&&"function"==typeof t.remove&&t.remove(),this.currentTopHeaderClone=null,this.cloneHeaderHeight=null,this.currentTopIndex=null,this.headerEls=null},i.prototype.beforeShow=function(){},i.prototype.afterShow=function(){return this.initStickyHeaders()},i.prototype.beforeHide=function(){},i.prototype.afterHide=function(){return this.resetStickyHeaders()},i.prototype.setTalking=function(t){return t?this.panelEl.addClass("talking"):(this.hideDtmf(),this.panelEl.removeClass("talking"))},i.prototype.sendDtmf=function(t){return this.oktell.dtmf((""+t).replace("∗","*"))},i.prototype.toggleDtmf=function(){return this.panelEl.hasClass("dtmf")?this.hideDtmf():this.showDtmf()},i.prototype.showDtmf=function(t){var e=this;return"talk"===this.oktell.getState()&&this.panelEl.hasClass("webphone")&&!this.panelEl.hasClass("dtmf")?(this.panelEl.addClass("dtmf"),this.dtmfEl.stop(!0,!0),t?(this.dtmfEl.show(),this.initStickyHeaders()):(this.resetStickyHeaders(),this.dtmfEl.slideDown(200,function(){return e.initStickyHeaders()}))):void 0},i.prototype.hideDtmf=function(t){var e=this;return this.panelEl.hasClass("dtmf")?(this.panelEl.removeClass("dtmf"),this.dtmfEl.stop(!0,!0),t?(this.dtmfEl.hide(),this.initStickyHeaders()):(this.resetStickyHeaders(),this.dtmfEl.slideUp(200,function(){return e.initStickyHeaders()}))):void 0},i.prototype.onPbxNumberStateChange=function(t){var e,n,i,s,o,r,l,a,h,u,c,d,p,f,m,g;for(u=t.numbers,g=[],a=0,h=u.length;h>a;a++)i=u[a],s=""+i.num,o=this.usersByNumber[s],o?(e=null,e=this.showDeps?this.departmentsById[o.departmentId]:this.allUserDep,l=o.isFiltered(this.filter,this.showOffline,this.filterLang),o.setState(i.numstateid),r=o.isFiltered(this.filter,this.showOffline,this.filterLang),r?l?g.push(void 0):(e.getUsers(this.filter,this.showOffline,this.filterLang),n=e.lastFilteredUsers.indexOf(o),-1!==n?e.getContainer().is(":visible")?(0===n?e.getContainer().prepend(o.getEl()):null!=(d=e.lastFilteredUsers[n-1])&&null!=(p=d.el)&&p.after(o.getEl()),(null!=(f=e.lastFilteredUsers[n-1])?f.letter:void 0)===o.letter?g.push(o.letterVisibility(!1)):(null!=(m=e.lastFilteredUsers[n+1])?m.letter:void 0)===o.letter?g.push(e.lastFilteredUsers[n+1].letterVisibility(!1)):g.push(void 0)):g.push(this.setFilter(this.filter,!0,!0)):g.push(void 0)):1===e.getContainer().children().length?g.push(this.setFilter(this.filter,!0,!0)):g.push(null!=(c=o.el)?"function"==typeof c.detach?c.detach():void 0:void 0)):g.push(void 0);return g},i.prototype.hideActionListDropdown=function(){var t=this;return this.dropdownEl.fadeOut(150,function(){return t.dropdownOpenedOnPanel=!1})},i.prototype.showPanel=function(t){var e,n=this;return this.contained?t?this.panelEl.show():this.panelEl.fadeIn(200):(e=this.panelEl.data("width"),e>0&&this.panelEl.data("hided")?(this.panelEl.data("width",e),this.panelEl.data("hided",!1),this.panelEl.css({display:""}),t?this.panelEl.css({overflow:"",width:e+"px"}):this.panelEl.animate({width:e+"px"},200,function(){return n.panelEl.css({overflow:""})})):void 0)},i.prototype.hidePanel=function(t){var e,n=this;return this.contained?t?this.panelEl.hide():this.panelEl.fadeOut(200):(e=null!=this.panelEl.data("width")?this.panelEl.data("width"):this.panelEl.width(),e>0&&!this.panelEl.data("hided")?(this.panelEl.data("width",e),this.panelEl.data("hided",!0),t?this.panelEl.css({display:"",overflow:"hidden",width:"0px"}):this.panelEl.animate({width:"0px"},200,function(){return n.panelEl.css({display:"",overflow:"hidden"})})):void 0)},i.prototype.getUserButtonForPlugin=function(t){var e,n,i=this;return n=this.getUser(t),this.oktellConnected||this.usersWithBeforeConnectButtons.push(n),this.userWithGeneratedButtons[t]=n,e=n.getButtonEl(),e.find(".drop_down").bind("click",function(){var t;return t=n.loadActions(),i.showDropdown(n,e,t)}),e},i.prototype.clearFilter=function(){return this.filterInput.val(""),this.setFilter(""),this.filterInput.keyup()},i.prototype.toggleKeypadVisibility=function(){return this.setKeypadVisibility(!this.keypadIsVisible)},i.prototype.setKeypadVisibility=function(t){var e=this;return null!=t&&Boolean(this.keypadIsVisible)!==Boolean(t)?(this.keypadIsVisible=Boolean(t),this.keypadEl.stop(!0,!0),this.resetStickyHeaders(),this.keypadIsVisible?this.keypadEl.slideDown({duration:200,easing:"linear",done:function(){return e.setUserListHeight(),e.initStickyHeaders()}}):this.keypadEl.slideUp({duration:200,easing:"linear",done:function(){return e.setUserListHeight(),e.initStickyHeaders()}})):void 0},i.prototype.addEventListenersForButton=function(e,n){var i=this;return n.bind("click",function(){return e?i.showDropdown(e,t(i)):void 0})},i.prototype.showDropdown=function(e,n,i,s){var o,r,l,a,h,u;if(l=this.dropdownElLiTemplate,this.dropdownEl.empty(),null!=i?!i.length:true)return this.dropdownEl.hide();for(r=[],a=0,h=i.length;h>a;a++)o=i[a],"string"==typeof o&&(null!=(u=this.allActions[o])?u.text:void 0)&&r.push(l.replace(this.regexps.actionText,this.allActions[o].text).replace(this.regexps.action,o).replace(this.regexps.css,this.actionCssPrefix+o.toLowerCase()));return r.length?(this.dropdownEl.append(r.join("")),this.dropdownEl.children("li:first").addClass("g_first"),this.dropdownEl.children("li:last").addClass("g_last"),this.dropdownEl.data("user",e),this.dropdownEl.css({top:this.dropdownEl.height()+n.offset().top>t(window).height()?t(window).height()-this.dropdownEl.height()-this.dropdownPaddingBottomLeft:n.offset().top,left:Math.max(this.dropdownPaddingBottomLeft,n.offset().left-this.dropdownEl.width()+n.width()),visibility:"visible"}),this.dropdownEl.fadeIn(100),s?this.dropdownOpenedOnPanel=!0:void 0):this.dropdownEl.hide()},i.prototype.logUsers=function(){var t,e,n,i;n=this.panelUsersFiltered,i=[];for(t in n)__hasProp.call(n,t)&&(e=n[t],i.push(this.log(e.getInfo())));return i},i.prototype.syncAbonentsAndUserlist=function(e,n){var i,s,o,r,l,a,h=this;if(i={},0===(null!=e?e.length:void 0)||1===e.length&&(null!=(r=e[0])?r.isIvr:void 0)&&!(null!=(l=e[0])?l.phone:void 0))for(s in n)__hasProp.call(n,s)&&(o=n[s],delete n[s]);t.each(e,function(t,e){var s,o,r;if(e&&(s=(null!=(r=e.phone)?"function"==typeof r.toString?""+r:void 0:void 0)||e.ivrName||""))return i[s]=e,n[""+s]?void 0:(o=h.getUser({name:e.name,number:e.phone||"",id:e.userid,state:e.isIvr?5:1,isIvr:e.isIvr,ivrName:e.ivrName},e.isIvr&&!e.phone),n[""+s]=o)}),a=[];for(s in n)__hasProp.call(n,s)&&(o=n[s],i[o.number]?a.push(void 0):a.push(delete n[o.number]));return a},i.prototype.setAbonents=function(t){var e,n,i,s,o=this;this.log("setAbonents",t,this.abonents),i=this.abonents;for(n in i)__hasProp.call(i,n)&&(e=i[n],e.removeAction("dtmf"));if(this.syncAbonentsAndUserlist(t,this.abonents),this.log("setAbonents synced",this.abonents),!this.oktell.conferenceId){s=this.abonents;for(n in s)__hasProp.call(s,n)&&(e=s[n],e.addAction("dtmf",function(){return o.toggleDtmf()}))}return this.setAbonentsHtml(),setTimeout(function(){return o.setUserListHeight()},200)},i.prototype.setQueue=function(t){var e,n,i,s,o,r;if("ring"===this.oktell.getState())for(n=s=0,o=t.length;o>s;n=++s)e=t[n],this.abonents[e.phone]&&delete t[n];this.syncAbonentsAndUserlist(t,this.queue),r=this.queue;for(n in r)__hasProp.call(r,n)&&(i=r[n],i.loadActions());return this.setQueueHtml()},i.prototype.setHold=function(t){var e;return e=[],t.hasHold&&(e=t.conferenceid?[{number:t.conferenceRoom,id:t.conferenceid,name:t.conferenceName}]:[t.abonent]),this.syncAbonentsAndUserlist(e,this.hold),this.setHoldHtml()},i.prototype.setPanelUsersHtml=function(t){return this._setUsersHtml(t,this.usersListEl),this.userScrollerToTop()},i.prototype.setAbonentsHtml=function(){return this._setActivityPanelUserHtml(this.abonents,this.abonentsListEl,this.abonentsListBlock)},i.prototype.setHoldHtml=function(){return this._setActivityPanelUserHtml(this.hold,this.holdListEl,this.holdBlockEl)},i.prototype.setQueueHtml=function(){return this._setActivityPanelUserHtml(this.queue,this.queueListEl,this.queueBlockEl)},i.prototype._setActivityPanelUserHtml=function(t,e,n){var i,s,o,r=this;o=[];for(i in t)__hasProp.call(t,i)&&(s=t[i],o.push(s));return this._setUsersHtml(o,e,!0),o.length&&n.is(":not(:visible)")?(n.stop(!0,!0),this.resetStickyHeaders(),n.slideDown(50,function(){return r.setUserListHeight(),r.initStickyHeaders()})):0===o.length&&n.is(":visible")?(n.stop(!0,!0),this.resetStickyHeaders(),n.slideUp(50,function(){return r.setUserListHeight(),r.initStickyHeaders()})):void 0},i.prototype._setUsersHtml=function(t,e,n){var i,s,o,r,l,a,h;for(i=[],s=null,o="",a=0,h=t.length;h>a;a++)r=t[a],l=r.getEl(n),null!=(null!=l?l[0]:void 0)&&i.push(l[0]),r.showLetter(o!==r.letter?!0:!1),o=r.letter;return e.children().detach(),e.html(i)},i.prototype.setFilter=function(e,n,i){var s,o,r,l,a,h,u,c,d,p=this;if(this.filter===e&&!n)return!1;if(a=this.filter,this.filter=e,this.filterLang=e.match(/^[^А-яёЁ]+$/)?"en":e.match(/^[^A-z]+$/)?"ru":"",l=!1,this.timer(),this.panelUsersFiltered=[],s=[],h=function(t){var n,i,o,r;return i=t.getEl(""!==e),null!=(null!=i?i[0]:void 0)?(i=i[0],n=!1,r=t.getUsers(e,p.showOffline,p.filterLang),o=r[0],n=r[1],p.panelUsersFiltered=p.panelUsersFiltered.concat(o),0!==o.length?(l||(l=n),p._setUsersHtml(o,t.getContainer()),n&&l===n?s.unshift(i):s.push(i)):void 0):void 0},this.showDeps)for(d=this.departments,u=0,c=d.length;c>u;u++)o=d[u],h(o);else h(this.allUserDep);return!l&&e.match(/[0-9\(\)\+\-]/)?(this.filterFantomUser=this.getUser({name:e,number:e},!0),this.exactMatchUserDep.clearUsers(),this.exactMatchUserDep.addUser(this.filterFantomUser),r=this.exactMatchUserDep.getEl(),this._setUsersHtml([this.filterFantomUser],this.exactMatchUserDep.getContainer()),this.filterFantomUser.showLetter(!1),null!=(null!=r?r[0]:void 0)&&s.unshift(r[0])):this.filterFantomUser=!1,this.scrollContent.children().detach(),this.scrollContent.html(s),s.length>0&&t(s[s.length-1]).find("tr:last").addClass("g_last"),this.initStickyHeaders(),i||this.userScrollerToTop(),setTimeout(function(){return p.setUserListHeight()},1),this.timer(!0)},i.prototype.getUser=function(t,n){var i,s,o,r;return this.log("getUser dontRemember="+n,t),"string"==typeof t||"number"==typeof t?(o=""+t,t={number:o}):o=""+t.number,this.log("getUser strNumber="+o),s=t.phoneFormatted||("function"==typeof O.formatPhone?O.formatPhone(o):void 0)||o,t.numberFormatted||(t.numberFormatted=s),t.isIvr||n||(null!=(r=this.filterFantomUser)?r.number:void 0)!==o||(this.usersByNumber[o]=this.filterFantomUser,t.isFantom=!0,this.filterFantomUser=!1),t.isIvr&&!t.number||!this.usersByNumber[o]?(i=new e({number:o,numberFormatted:s,name:t.name,isFantom:!0,state:null!=(null!=t?t.state:void 0)?t.state:1,isIvr:null!=t?t.isIvr:void 0,ivrName:null!=t?t.ivrName:void 0}),n||(this.usersByNumber[o]=i),i):(this.usersByNumber[o].isFantom&&this.usersByNumber[o].init(t),this.usersByNumber[o])},i.prototype.reloadActions=function(){var t=this;return setTimeout(function(){var e,n,i,s,o,r,l,a;s=t.userWithGeneratedButtons;for(n in s)__hasProp.call(s,n)&&(i=s[n],e=i.loadActions());o=t.abonents;for(n in o)i=o[n],i.loadActions();r=t.queue;for(n in r)i=r[n],i.loadActions();l=t.panelUsersFiltered,a=[];for(n in l)i=l[n],a.push(i.loadActions());return a},100)},i.prototype.timer=function(t){return t&&this._time,t?void 0:this._time=Date.now()},i.prototype.beforeUserAction=function(t){return this.filterFantomUser&&t===this.filterFantomUser?this.clearFilter():void 0},i.prototype.config=function(t){var e,n,i,s;if(!this._config){if(("undefined"!=typeof localStorage&&null!==localStorage?localStorage.oktellPanel:void 0)&&("undefined"!=typeof JSON&&null!==JSON?JSON.parse:void 0)){try{this._config=JSON.parse(localStorage.oktellPanel)}catch(o){e=o}(null==this._config||"object"!=typeof this._config)&&(this._config={})}else this._config={};s=this.defaultConfig;for(n in s)__hasProp.call(s,n)&&(i=s[n],null==this._config[n]&&(this._config[n]=i))}if(null!=t){for(n in t)__hasProp.call(t,n)&&(i=t[n],this._config[n]=i);localStorage&&("undefined"!=typeof JSON&&null!==JSON?JSON.stringify:void 0)&&localStorage.setItem("oktellPanel",JSON.stringify(this._config))}return this.showDeps=this._config.showDeps,this.showOffline=this._config.showOffline,this.buttonShowOffline.toggleClass("g_active",!this.showOffline),this.buttonShowOffline.attr("title",this.showOffline?this.langs.panel.showOnlineOnly:this.langs.panel.showOnlineOnlyCLicked),this.buttonShowDeps.toggleClass("g_active",this.showDeps),this.buttonShowDeps.attr("title",this.showDeps?this.langs.panel.showDepartmentsClicked:this.langs.panel.showDepartments),this._config},i}(),l=function(){function e(t,e,n){var i,s=this;this.el=t,this.ringtone=n,this.absContainer=this.el.find(".b_content"),this.abonentEl=this.absContainer.find(".b_abonent").remove(),this.answerActive=!1,this.answerButttonEl=this.el.find(".j_answer"),this.puckupEl=this.el.find(".j_pickup"),this.el.find(".j_abort_action").bind("click",function(){return s.hide(),s.playRingtone(!1),e.endCall()}),this.el.find(".j_answer").bind("click",function(){return s.hide(),s.playRingtone(!1),e.answer()}),this.el.find(".j_close_action").bind("click",function(){return s.hide()}),this.el.find("i.o_close").bind("click",function(){return s.hide()}),i=!1,e.on("connect",function(){return s.users=e.getUsers()}),e.on("webrtcRingStart",function(t,e){var n;return s.log("webrtcRingStart, "+e),s.playRingtone(!0),s.answerButtonVisible(!0),i||s.setAbonents([{name:t,phone:(null!=(n=e.match(/<sip:([\s\S]+?)@/))?n[1]:void 0)||""}]),s.show()}),e.on("ringStart backRingStart",function(t){return s.log("ringStart",t),s.setAbonents(t),setTimeout(function(){var n,i;return(null!=t?null!=(n=t[0])?n.phone:void 0:void 0)&&-1!==(null!=(i=e.getPhoneActions(t[0].phone))?"function"==typeof i.indexOf?i.indexOf("answer"):void 0:void 0)?s.answerButtonVisible(!0):void 0},10),i=!0,s.show()}),e.on("ringStop",function(){return s.playRingtone(!1),s.hide(),i=!1,s.setAbonents([])}),this.answerButtonVisible(!1)}return e.prototype.logGroup="Popup",e.prototype.playRingtone=function(t){return this.ringtone?t?(this.ringtone.currentTime=0,this.ringtone.play()):this.ringtone.pause():void 0},e.prototype.show=function(t){return this.log("Popup show! ",t),this.el.fadeIn(200)},e.prototype.hide=function(){return this.playRingtone(!1),this.el.fadeOut(200)},e.prototype.setAbonents=function(e){var n=this;return this.absContainer.empty(),t.each(e,function(t,e){var i,s,o,r,l,a,h,u,c,d;if(!e)return n.log("setAbonent: bad abonent"),void 0;if(l=null!=(u=e.phoneFormatted)?"function"==typeof u.toString?""+u:void 0:void 0,r=null!=(c=e.phone)?"function"==typeof c.toString?""+c:void 0:void 0,o=null!=(d=e.name)?"function"==typeof d.toString?""+d:void 0:void 0,o===r){s=!1;for(a in n.users)if(h=n.users[a],n.log("Number = "+h.number),h.number===r){o=h.name,s=!0;break}n.log("Found "+r+" in users = "+s),s||(o=l||r,r="")}else o=""+e.name;return i=n.abonentEl.clone(),i.find("span:first").text(o),i.find("span:last").text(r),n.absContainer.append(i)})},e.prototype.answerButtonVisible=function(t){return t?(this.answerActive=!0,this.answerButttonEl.show(),this.puckupEl.hide()):(this.answerActive=!1,this.answerButttonEl.hide(),this.puckupEl.show()),this.answerActive},e.prototype.setCallbacks=function(t,e){return this.onAnswer=t,this.onTerminate=e},e}(),r=function(){function t(t,e){var n=this;this.el=t,e&&(e.on("mediaPermissionsRequest",function(){return n.show()}),e.on("mediaPermissionsAccept",function(){return n.hide()}),e.on("mediaPermissionsRefuse",function(){return O!==void 0&&null!==O&&O.endCall(),n.hide()}))}return t.prototype.show=function(){return this.log("Permissions Popup show!"),this.el.show()},t.prototype.hide=function(){return this.el.fadeOut(200)},t}(),i=function(){function t(t,e){var n=this;this.el=t,e.on("connecting",function(){return n.hide()}),e.on("disconnect",function(t){return n.log("disconnect with reason "+t.code+" "+t.message),12===t.code?n.show(3,e.getMyInfo().login):void 0}),e.on("connectError",function(t){switch(n.log("connect error "+t.errorCode+" "+t.errorMessage),t.errorCode){case 12:return n.show(1,e.getMyInfo().login);case 13:return n.show(2,e.getMyInfo().login);case 1204:return n.show(1,e.getMyInfo().login);case 1202:return n.show(2,e.getMyInfo().login);default:return n.show(3,e.getMyInfo().login)}})}return t.prototype.logGroup="Error",t.prototype.errorTypes={1:"usingOktellClient",2:"loginPass",3:"unavailable"},t.prototype.onShow=function(){},t.prototype.show=function(t,e){var n,i,s;return this.errorTypes[t]?(this.log("show "+t),n=this.errorTypes[t],this.el.find("p:eq(0)").text(this.langs[n].header.replace("%username%",e)),this.el.find("p:eq(1)").text((null!=(i=this.langs[n].message)?i.replace("%username%",e):void 0)||""),this.el.find("p:eq(3)").text((null!=(s=this.langs[n].message2)?s.replace("%username%",e):void 0)||""),"function"==typeof this.onShow&&this.onShow(),this.el.fadeIn(200)):!1},t.prototype.hide=function(){return this.el.fadeOut(200)},t}(),v={position:"right",dynamic:!1,oktell:window.oktell,oktellVoice:window.oktellVoice,ringtone:"ringtone.mp3",debug:!1,lang:"ru",showAvatar:!1,hideOnDisconnect:!0,useNotifies:!1,withoutPermissionsPopup:!1,withoutCallPopup:!1,withoutError:!1},S={ru:{panel:{dtmf:"донабор",dtmfPanelName:"Донабор",inTalk:"В разговоре",onHold:"На удержании",queue:"Очередь ожидания",inputPlaceholder:"введите имя или номер",withoutDepartment:"без отдела",showDepartments:"Группировать по отделам",showDepartmentsClicked:"Показать общим списком",showOnlineOnly:"Показать только online",showOnlineOnlyCLicked:"Показать всех"},actions:{answer:"Ответить",call:"Позвонить",conference:"Конференция",transfer:"Перевести",toggle:"Переключиться",intercom:"Интерком",endCall:"Завершить",ghostListen:"Прослушка",ghostHelp:"Помощь",hold:"Удержание",resume:"Продолжить",dtmf:"Донабор"},callPopup:{title:"Входящий вызов",hide:"Скрыть",answer:"Ответить",reject:"Отклонить",undefinedNumber:"Номер не определен",goPickup:"Поднимите трубку",answer:"Ответить"},permissionsPopup:{header:"Запрос на доступ к микрофону",text:"Для использования веб-телефона необходимо разрешить браузеру доступ к микрофону."},error:{title:"Ошибка",usingOktellClient:{header:"Пользователь «%username%» использует стандартный Oktell-клиент.",message:"Одновременная работа двух типов клиентских приложений невозможна.",message2:"Закройте стандартный Oktell-клиент и повторите попытку."},loginPass:{header:"Пароль для пользователя «%username%» не подходит.",message:"Проверьте правильность имени пользователя и пароля."},unavailable:{header:"Сервер телефонии Oktell не доступен.",message:"Убедитесь что сервер телефонии работает и проверьте настройки соединения."}}},en:{panel:{dtmf:"dtmf",dtmfPanelName:"DTMF",inTalk:"In conversation",onHold:"On hold",queue:"Wait queue",inputPlaceholder:"Enter name or number",withoutDepartment:"Without department",showDepartments:"Show departments",showDepartmentsClicked:"Hide departments",showOnlineOnly:"Show online only",showOnlineOnlyCLicked:"Show all"},actions:{answer:"Answer",call:"Dial",conference:"Conference",transfer:"Transfer",toggle:"Switch",intercom:"Intercom",endCall:"End",ghostListen:"Audition",ghostHelp:"Help",hold:"Hold",resume:"Resume",dtmf:"DTMF"},callPopup:{title:"Incoming call",hide:"Hide",answer:"Answer",reject:"Decline",undefinedNumber:"Phone number is not defined",goPickup:"Pick up the phone",answer:"Answer"},permissionsPopup:{header:"Request for access to the microphone",text:"To use the web-phone you need to allow browser access to the microphone."},error:{title:"Error",usingOktellClient:{header:"User «%username%» uses standard Oktell client application.",message:"Simultaneous work of two types of client applications is not possible.",message2:"Close standard Oktell client application and try again."},loginPass:{header:"Wrong password for user «%username%».",message:"Make sure that the username and password are correct."},unavailable:{header:"Oktell server is not available.",message:"Make sure that Oktell server is running and check your connection."}}},cz:{panel:{dtmf:"dtmf",dtmfPanelName:"DTMF",inTalk:"V rozhovoru",onHold:"Na hold",queue:"Fronta čekaní",inputPlaceholder:"zadejte jméno nebo číslo",withoutDepartment:"Bez oddělení",showDepartments:"Zobrazit oddělení",showDepartmentsClicked:"Skrýt oddělení",showOnlineOnly:"Zobrazit pouze online",showOnlineOnlyCLicked:"Zobrazit všechny"},actions:{answer:"Odpověď",call:"Zavolat",conference:"Konference",transfer:"Převést",toggle:"Přepnout",intercom:"Intercom",endCall:"Ukončit",ghostListen:"Odposlech",ghostHelp:"Nápověda",hold:"Udržet",resume:"Pokračovat",dtmf:"DTMF"},callPopup:{title:"Příchozí hovor",hide:"Schovat",answer:"Odpovědět",reject:"Odmítnout",undefinedNumber:"",goPickup:"Zvedněte sluchátko",answer:"Odpovědět"},permissionsPopup:{header:"Žádost o přístup k mikrofonu",text:"Abyste mohli používat telefon, musíte povolit prohlížeče přístup k mikrofonu."},error:{title:"Chyba",usingOktellClient:{header:"Uživatel «%username%» používá standardní Oktell klientské aplikace.",message:"Současnou práci dvou typů klientských aplikací není možné.",message2:"Zavřít Oktell standardní klientskou aplikaci a zkuste to znovu."},loginPass:{header:"Chybné heslo uživatele «%username%».",message:"Ujistěte se, že uživatelské jméno a heslo jsou správné."},unavailable:{header:"Oktell server není k dispozici.",message:"Ujistěte se, že Oktell server běží a zkontrolujte připojení."}}}},U=null,u=null,O=null,D=!1,p=null,j=null,R=null,F=null,y=null,B=null,m=null,a="oktellPanelActionButton",C=function(){return U||v},H=navigator.userAgent.match(/(Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone)/i)?!0:!1,Y=!H,W=H,f=function(){var t,e,n,i,s,o,r;for(t=document.createElement("div"),e=t.style,n="Transform",i=["o"+n,"ms"+n,"webkit"+n,"Webkit"+n,"Moz"+n,"transform"],o=0,r=i.length;r>o;o++)if(s=i[o],null!=e[s])return!0;return e},L="",A=function(){var t,e,n,i,s,o,r,l,a,h;if(t=arguments.length>=1?__slice.call(arguments,0):[],C().debug){for(e=new Date,n=e.getFullYear()+"-"+(10>e.getMonth()?"0":"")+e.getMonth()+"-"+(10>e.getDate()?"0":"")+e.getDate(),r=(10>e.getHours()?"0":"")+e.getHours()+":"+(10>e.getMinutes()?"0":"")+e.getMinutes()+":"+(10>e.getSeconds()?"0":"")+e.getSeconds()+":"+(""+(e.getMilliseconds()+1e3)).substr(1),L+=n+" "+r+" | ",s="log","error"===(""+t[0]).toLowerCase()&&(s="error"),o=a=0,h=t.length;h>a;o=++a){if(l=t[o],"object"==typeof l)try{L+=JSON.stringify(l)}catch(u){i=u,L+=""+l}else L+=l;L+=" | "}L+="\n\n",t.unshift("Oktell-Panel.js "+r+" |"+("string"==typeof this.logGroup?" "+this.logGroup+" |":""));try{return console[s].apply(console,t||[])}catch(u){i=u}}},z={"templates/actionButton.html":'<ul class="oktell_button_action"><li class="g_first"><i></i></li><li class="g_last drop_down"><i></i></li></ul>',"templates/actionList.html":'<ul class="oktell_actions_group_list"><li class="{{css}}" data-action="{{action}}"><i></i><span>{{actionText}}</span></li></ul>',"templates/user.html":'<tr class="b_contact"><td class="b_contact_avatar {{css}}"><img src="{{avatarLink32x32}}"><i></i><div class="o_busy"></div></td><td class="b_capital_letter"><span></span></td><td class="b_contact_title"><div class="wrapword"><span class="b_contact_name"><b>{{name1}}</b><span>{{name2}}</span></span><span class="o_number">{{number}}</span><span class="o_dtmf">{{dtmf}}</span></div>{{button}}</td></tr>',"templates/department.html":'<tr class="b_contact"><td class="b_contact_department" colspan="3">{{department}}</td></tr>',"templates/dep.html":'<div class="b_department"><div class="b_department_header"><div class="h_shadow_top"><span>{{department}}</span></div></div><table class="b_main_list"><tbody></tbody></table></div>',"templates/usersTable.html":'<table class="b_main_list m_without_department"><tbody></tbody></table>',"templates/panel.html":'<div class="oktell_panel"><div class="i_panel_bookmark"><div class="i_panel_bookmark_bg"></div></div><div class="h_panel_bg"><div class="b_header"><ul class="b_list_filter"><li class="i_group"></li><li class="i_online"></li></ul></div><div class="h_padding"><div class="b_marks i_conference j_abonents"><div class="h_shadow_top"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{inTalk}}</span><span class="b_marks_time"></span></p><table><tbody></tbody></table></div></div></div><div class="b_marks i_extension" style="display: none"><div class="h_shadow_top"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{dtmfPanelName}}</span></p><div class="h_btn-group"><div class="btn-group"><button class="btn btn-small">1</button><button class="btn btn-small">2</button><button class="btn btn-small">3</button><button class="btn btn-small">4</button><button class="btn btn-small">5</button><button class="btn btn-small">6</button><button class="btn btn-small">7</button><button class="btn btn-small">8</button><button class="btn btn-small">9</button><button class="btn btn-small">0</button></div><div class="btn-group"><button class="btn btn-small">&lowast;</button><button class="btn btn-small">#</button></div></div></div></div><i class="o_close"></i></div><div class="b_marks i_flash j_hold"><div class="h_shadow_top"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{onHold}}</span></p><table class="j_table_favorite"><tbody></tbody></table></div></div></div><div class="b_marks i_flash j_queue"><div class="h_shadow_top"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{queue}}</span></p><table class="j_table_queue"><tbody></tbody></table></div></div></div><div class="b_inconversation j_phone_block"><table class="j_table_phone"><tbody></tbody></table></div><div class="b_marks i_phone"><div class="h_shadow_top"><div class="h_phone_number_input"><div class="i_phone_state_bg"></div><div class="h_input_padding"><div class="jInputClear_hover"><input class="b_phone_number_input" type="text" placeholder="{{inputPlaceholder}}"><span class="jInputClear_close">&times;</span></div></div></div></div></div><div class="b_sticky_header_container"></div><div class="h_main_list j_main_list"></div></div></div></div>',"templates/callPopup.html":'<div class="oktell_panel_popup" style="display: none"><div class="m_popup_staff"><div class="m_popup_data"><header><div class="h_header_bg"><i class="o_close"></i><h2>{{title}}</h2></div></header><div class="b_content"><div class="b_abonent"><span data-bind="text: name"></span>&nbsp;<span class="g_light" data-bind="textPhone: number"></span></div></div><div class="footer"><div class="b_take_phone j_pickup"><i></i>&nbsp;<span>{{goPickup}}</span></div><button class="oktell_panel_btn m_big m_button_green j_answer" style="margin-right: 20px; float: left"><i></i>{{answer}}</button><button class="oktell_panel_btn m_big j_close_action">{{hide}}</button><button class="oktell_panel_btn m_big m_button_red j_abort_action"><i></i>{{reject}}</button></div></div></div></div>',"templates/permissionsPopup.html":'<div class="oktell_panel_popup" style="display: none"><div class="m_popup_staff"><div class="m_popup_data"><header><div class="h_header_bg"><h2>{{header}}</h2></div></header><div class="b_content"><p>{{text}}</p></div></div></div></div>',"templates/error.html":'<div class="b_error m_form" style="display: none"><div class="h_padding"><h4>{{title}}</h4><p class="b_error_alert"></p><p class="g_light"></p><p class="g_light"></p></div></div>'},T=function(e){var n;return"/"===e[0]&&(e=e.substr(1)),null!=z[e]?z[e]:(n="",t.ajax({url:e,async:!1,success:function(t){return n=t}}),n)},h=T("/templates/actionButton.html"),c=T("/templates/actionList.html"),J=T("/templates/user.html"),w=T("/templates/department.html"),w=T("/templates/dep.html"),G=T("/templates/usersTable.html"),N=T("/templates/panel.html"),q=T("/templates/callPopup.html"),V=T("/templates/permissionsPopup.html"),_=T("/templates/error.html"),s.prototype.usersTableTemplate=G,e.prototype.buttonTemplate=h,e.prototype.log=A,s.prototype.log=A,l.prototype.log=A,r.prototype.log=A,n.prototype.log=A,i.prototype.log=A,n.prototype.template=w,M=!1,P=function(o){var a,d,g,b,k,x,E,P,H,T,A,L,I,D,z,G,Q,$,X,K,Z,te,ee,ne,ie,se,oe,re,le,ae,he,ue,ce,de;return M=!0,U=t.extend({},v,o||{}),he=!1,P=(null!=(de=C().container)?de[0]:void 0)||C().container,m=null,P&&"object"==typeof HTMLElement&&P instanceof HTMLElement||1===(null!=P?P.nodeType:void 0)&&"string"==typeof P.nodeName?(m=t(P),he=!0):m=t("body"),he&&(Y=!1,W=!0),U.oktellVoice&&(U.oktellVoice.isOktellVoice===!0?U.oktellVoice=U.oktellVoice:window.oktellVoice(window.oktellVoice.isOktellVoice===!0)&&(U.oktellVoice=window.oktellVoice)),C().useNotifies&&window.webkitNotifications&&1===window.webkitNotifications.checkPermission()&&webkitNotifications.requestPermission(function(){}),n.prototype.withoutDepName=s.prototype.withoutDepName=e.prototype.withoutDepName="zzzzz_without",S=S[U.lang]||S.ru,e.prototype.template=J.replace("{{button}}",h),N=N.replace("{{inTalk}}",S.panel.inTalk).replace("{{dtmfPanelName}}",S.panel.dtmfPanelName).replace("{{onHold}}",S.panel.onHold).replace("{{queue}}",S.panel.queue).replace("{{inputPlaceholder}}",S.panel.inputPlaceholder),s.prototype.langs=S,s.prototype.departmentTemplate=w,i.prototype.langs=S.error,e.prototype.langs=S,n.prototype.langs=S,B=t(N),C().showAvatar||B.addClass("noavatar"),a=t(J),d=t(h),$=d.attr("data-bind"),d.attr("data-bind",$+", visible: $data.actionBarIsVisible"),a.find("td.b_contact_title").append(d),u=t(c),t("body").append(u),O=C().oktell,e.prototype.formatPhone=O.formatPhone,oe=null,C().ringtone&&(oe=t('<audio src="'+C().ringtone+'" id="oktell_panel_ringtone" preload="auto"></audio>')[0],t("body").append(oe),oe.loop=!0),C().withoutCallPopup||(q=q.replace("{{title}}",S.callPopup.title).replace("{{goPickup}}",S.callPopup.goPickup).replace("{{answer}}",S.callPopup.answer).replace("{{hide}}",S.callPopup.hide).replace("{{reject}}",S.callPopup.reject),se=t(q),t("body").append(se),R=new l(se,O,oe)),C().withoutPermissionsPopup||(V=V.replace("{{header}}",S.permissionsPopup.header).replace("{{text}}",S.permissionsPopup.text),ie=t(V),t("body").append(ie),F=new r(ie,C().oktellVoice)),C().withoutError||(_=_.replace("{{title}}",S.error.title),A=t(_),B.find(".h_panel_bg:first").append(A),y=new i(A,O)),ee=C().position,b={},b[ee]="0px",g={},g[ee]="-281px",te=-281,B.hide(),he&&B.addClass("contained"),m.append(B),j=new s(O,B,u,p,C(),he,Y,W,C().debug),C().debug&&(window.wList=j,window.wPopup=R,window.wError=y),"right"===ee?B.addClass("right"):"left"===ee&&B.addClass("left"),C().dynamic&&B.addClass("dynamic"),he?void 0:(K=B.find(".i_panel_bookmark"),x={},E="left"===ee?"right":"left",x[E]="0px",k={},k[E]="-40px",Q=!1,Z=!1,ce="closed",ne=function(t){return t&&t!==ce&&(ce=t),ce
},D=function(){return clearTimeout(Z),Z=!1},ue=f(),le=null,I=null,H=!1,re=function(){return j.beforeShow(),ne("opening"),K.css(x),ue?H?void 0:(H=!0,B.css("right",""),clearTimeout(le),B.removeClass("hide_t_"+ee).addClass("show_t_"+ee),le=setTimeout(function(){return B.css("right","0px"),B.removeClass("show_t_"+ee),j.afterShow(),B.addClass("g_hover"),ne("open"),K.css(x),H=!1},200)):(B.stop(!0,!0),B.animate(b,100,"swing",function(){return j.afterShow(),B.addClass("g_hover"),ne("open"),K.css(x)}))},L=function(){return ue?H?void 0:(ne("closing"),j.beforeHide(),H=!0,B.css("right",""),clearTimeout(I),B.removeClass("show_t_"+ee).addClass("hide_t_"+ee),I=setTimeout(function(){return B.css("right","-281px"),B.removeClass("hide_t_"+ee),j.afterHide(),B.removeClass("g_hover"),K.css(k),ne("closed"),H=!1},400)):(ne("closing"),j.beforeHide(),B.stop(!0,!0),B.animate(g,300,"swing",function(){return B.css({panelPos:0}),j.afterHide(),B.removeClass("g_hover"),K.css(k),ne("closed")}))},B.bind("mouseenter",function(){return Q=!0,D(),0>parseInt(B.css(ee))&&("closed"===ne()||"closing"===ne())&&re(),!0}),X=!1,G=-250,z=30,ae=!1,T=!1,K.bind("touchstart",function(){return"closed"===ne()?ne("touchopening"):"open"===ne()&&ne("touchclosing"),!0}),K.bind("touchmove",function(t){var e,n,i,s;return("touchopening"===ne()||"touchclosing"===ne())&&(ae=!0),T&&ae&&(n=null!=t?null!=(i=t.originalEvent)?null!=(s=i.touches)?s[0]:void 0:void 0:void 0,n&&(X!==!1&&(e=parseInt(B.css(ee)),B.css(ee,Math.max(te,Math.min(0,e+X-n.pageX))+"px")),X=n.pageX)),!0}),K.bind("touchend",function(){var t;return ae?(ae=!1,t=parseInt(B.css(ee)),"touchopening"===ne()?t>G?re():L():"touchclosing"===ne()&&(z>t?L():openPanel())):"touchopening"===ne()&&re(),!0}),K.bind("touchcancel",function(){return!0}),t(window).bind("touchcancel",function(){return!0}),t(window).bind("touchend",function(e){var n,i,s;return s=t(e.target),n=s.parents(),i=n.toArray(),-1===i.indexOf(B[0])&&L(),!0}),B.bind("mouseleave",function(){return Q=!1,!0}),t("html").bind("mouseleave",function(){return D(),!0}),t("html").bind("mousemove",function(){return"open"!==ne()||Q||Z!==!1||j.dropdownOpenedOnPanel||(Z=setTimeout(function(){return L()},100)),!0}))},p=function(){return D=!0},E=function(t){var e,n;return t.addClass(C().buttonCss),n=t.attr("data-phone"),t.empty(),n?(e=j.getUserButtonForPlugin(n),t.html(e)):void 0},d=function(t){return E(t)},x=function(e){return t(e+":not(."+a+")").each(function(){return d(t(this))})},t.oktellPanel=function(t){if("string"==typeof t){if(M)return x(t)}else if(!M)return P(t)},t.fn.oktellButton=function(){return t(this).each(function(){return d(t(this))})},t.fn.oktellPanel=function(){var e;return e=arguments.length>=1?__slice.call(arguments,0):[],M?t(this)[0]===(null!=B?B[0]:void 0)?t.oktellPanel.apply(window,e):void 0:(e.container=t(this),t.oktellPanel.apply(window,e))},t.oktellPanel.show=function(){return j.showPanel()},t.oktellPanel.hide=function(){return j.hidePanel()}})($);